(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{"013z":function(e,t,n){"use strict";var a=n("q1tI"),r=n.n(a),o=n("NmYn"),s=n.n(o),l=n("Wbzz"),i=n("Xrax"),c=n("k4MR"),b=n("TSYQ"),d=n.n(b),p=n("QH2O"),u=n.n(p),m=n("qKvR"),h=function(e){var t,n=e.title,a=e.theme,r=e.tabs,o=void 0===r?[]:r;return Object(m.b)("div",{className:d()(u.a.pageHeader,(t={},t[u.a.withTabs]=o.length,t[u.a.darkMode]="dark"===a,t))},Object(m.b)("div",{className:"bx--grid"},Object(m.b)("div",{className:"bx--row"},Object(m.b)("div",{className:"bx--col-lg-12"},Object(m.b)("h1",{id:"page-title",className:u.a.text},n)))))},O=n("BAC9"),j=function(e){var t=e.relativePagePath,n=e.repository,a=Object(l.useStaticQuery)("1364590287").site.siteMetadata.repository,r=n||a,o=r.baseUrl,s=r.subDirectory,i=o+"/edit/"+r.branch+s+"/src/pages"+t;return o?Object(m.b)("div",{className:"bx--row "+O.row},Object(m.b)("div",{className:"bx--col"},Object(m.b)("a",{className:O.link,href:i},"Edit this page on GitHub"))):null},v=n("FCXl"),f=n("dI71"),x=n("I8xM"),g=function(e){function t(){return e.apply(this,arguments)||this}return Object(f.a)(t,e),t.prototype.render=function(){var e=this.props,t=e.title,n=e.tabs,a=e.slug,r=a.split("/").filter(Boolean).slice(-1)[0],o=n.map((function(e){var t,n=s()(e,{lower:!0,strict:!0}),o=n===r,i=new RegExp(r+"/?(#.*)?$"),c=a.replace(i,n);return Object(m.b)("li",{key:e,className:d()((t={},t[x.selectedItem]=o,t),x.listItem)},Object(m.b)(l.Link,{className:x.link,to:""+c},e))}));return Object(m.b)("div",{className:x.tabsContainer},Object(m.b)("div",{className:"bx--grid"},Object(m.b)("div",{className:"bx--row"},Object(m.b)("div",{className:"bx--col-lg-12 bx--col-no-gutter"},Object(m.b)("nav",{"aria-label":t},Object(m.b)("ul",{className:x.list},o))))))},t}(r.a.Component),N=n("MjG9"),y=n("CzIb"),S=n("Asxa"),I=n("OIbQ"),T=n.n(I),_=function(e){var t=e.date,n=new Date(t);return t?Object(m.b)(S.c,{className:T.a.row},Object(m.b)(S.a,null,Object(m.b)("div",{className:T.a.text},"Page last updated: ",n.toLocaleDateString("en-GB",{day:"2-digit",year:"numeric",month:"long"})))):null};t.a=function(e){var t=e.pageContext,n=e.children,a=e.location,r=e.Title,o=t.frontmatter,b=void 0===o?{}:o,d=t.relativePagePath,p=t.titleType,u=b.tabs,O=b.title,f=b.theme,x=b.description,S=b.keywords,I=b.date,T=Object(y.a)().interiorTheme,k=Object(l.useStaticQuery)("2456312558").site.pathPrefix,P=k?a.pathname.replace(k,""):a.pathname,F=u?P.split("/").filter(Boolean).slice(-1)[0]||s()(u[0],{lower:!0}):"",w=f||T;return Object(m.b)(c.a,{tabs:u,homepage:!1,theme:w,pageTitle:O,pageDescription:x,pageKeywords:S,titleType:p},Object(m.b)(h,{title:r?Object(m.b)(r,null):O,label:"label",tabs:u,theme:w}),u&&Object(m.b)(g,{title:O,slug:P,tabs:u,currentTab:F}),Object(m.b)(N.a,{padded:!0},n,Object(m.b)(j,{relativePagePath:d}),Object(m.b)(_,{date:I})),Object(m.b)(v.a,{pageContext:t,location:a,slug:P,tabs:u,currentTab:F}),Object(m.b)(i.a,null))}},BAC9:function(e,t,n){e.exports={bxTextTruncateEnd:"EditLink-module--bx--text-truncate--end--2pqje",bxTextTruncateFront:"EditLink-module--bx--text-truncate--front--3_lIE",link:"EditLink-module--link--1qzW3",row:"EditLink-module--row--1B9Gk"}},Ev3Q:function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return i})),n.d(t,"default",(function(){return d}));var a=n("wx14"),r=n("zLVn"),o=(n("q1tI"),n("7ljp")),s=n("013z"),l=(n("qKvR"),["components"]),i={},c={_frontmatter:i},b=s.a;function d(e){var t=e.components,n=Object(r.a)(e,l);return Object(o.b)(b,Object(a.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h1",null,"Access NFS server provisioned on IBM Cloud"),Object(o.b)("p",null,"When choosing the “simple” sample configuration for ROKS VPC on IBM Cloud, the deployer also provisions a Virtual Server Instance and installs a standard NFS server on it. In some cases you may want to get access to the NFS server for troubleshooting."),Object(o.b)("p",null,"For security reasons, the NFS server can only be reached via a bastion server that is connected to the internet, i.e. use the bastion server as a jump host, this to avoid exposing NFS volumes to the outside world and provide an extra layer of protection. Additionally, password login is disabled on both the bastion and NFS servers and one must use the private SSH key to connect."),Object(o.b)("h2",null,"Start the command line within the container"),Object(o.b)("p",null,"Getting SSH access to the NFS server is easiest from within the deployer container as it has all tools installed to extract the IP addresses from the Terraform state file."),Object(o.b)("p",null,"Ensure that your ",Object(o.b)("inlineCode",{parentName:"p"},"CONFIG_DIR")," and ",Object(o.b)("inlineCode",{parentName:"p"},"STATUS_DIR")," environment variables have been set and then run the deployer command."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},"export STATUS_DIR=/data/status/sample\nexport CONFIG_DIR=/data/config/sample\n")),Object(o.b)("p",null,"Start the deployer command line."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},"./cp-deploy.sh env command\n")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-output"},'-------------------------------------------------------------------------------\nEntering Cloud Pak Deployer command line in a container.\nUse the "exit" command to leave the container and return to the hosting server.\n-------------------------------------------------------------------------------\nInstalling OpenShift client\nCurrent OpenShift context: pluto-01\n')),Object(o.b)("h2",null,"Obtain private SSH key"),Object(o.b)("p",null,"Access to both the bastion and NFS servers are typically protected by the same SSH key, which is stored in the vault. To list all vault secrets, run the command below."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},"cd /cloud-pak-deployer\n./cp-deploy.sh vault list\n")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-output"},"./cp-deploy.sh vault list\n\nStarting Automation script...\n\nPLAY [Secrets] *****************************************************************\nSecret list for group sample:\n- ibm_cp_entitlement_key\n- sample-terraform-tfstate\n- cp4d_admin_zen_40_fke34d\n- sample-all-config\n- pluto-01-provision-ssh-key\n- pluto-01-provision-ssh-pub-key\n\nPLAY RECAP *********************************************************************\nlocalhost                  : ok=11   changed=0    unreachable=0    failed=0    skipped=21   rescued=0    ignored=0\n")),Object(o.b)("p",null,"Then, retrieve the private key (in the above example ",Object(o.b)("inlineCode",{parentName:"p"},"pluto-01-provision-ssh-key"),") to an output file in your ",Object(o.b)("inlineCode",{parentName:"p"},"~/.ssh")," directory, make sure it has the correct private key format (new line at the end) and permissions (600)."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'SSH_FILE=~/.ssh/pluto-01-rsa\nmkdir -p ~/.ssh\nchmod 600 ~/.ssh\n./cp-deploy.sh vault get -vs pluto-01-provision-ssh-key \\\n    -vsf $SSH_FILE\necho -e "\\n" >> $SSH_FILE\nchmod 600 $SSH_FILE\n')),Object(o.b)("h2",null,"Find the IP addresses"),Object(o.b)("p",null,"To connect to the NFS server, you need the public IP address of the bastion server and the private IP address of the NFS server. Obviously these can be retrieved from the IBM Cloud resource list (",Object(o.b)("a",{parentName:"p",href:"https://cloud.ibm.com/resources"},"https://cloud.ibm.com/resources"),"), but they are also kept in the Terraform “tfstate” file"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},"./cp-deploy.sh vault get -vs sample-terraform-tfstate \\\n    -vsf /tmp/sample-terraform-tfstate\n")),Object(o.b)("p",null,"The below commands do not provide the prettiest output but you should be able to extract the IP addresses from them."),Object(o.b)("p",null,"For the bastion node public (floating) IP address:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},"cat /tmp/sample-terraform-tfstate | jq -r '.resources[]' | grep -A 10 -E \"ibm_is_float\"\n")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-output"},'  "type": "ibm_is_floating_ip",\n  "name": "pluto_01_bastion",\n  "provider": "provider[\\"registry.terraform.io/ibm-cloud/ibm\\"]",\n  "instances": [\n    {\n      "schema_version": 0,\n      "attributes": {\n        "address": "149.81.215.172",\n...\n        "name": "pluto-01-bastion",\n')),Object(o.b)("p",null,"For the NFS server:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},"cat /tmp/sample-terraform-tfstate | jq -r '.resources[]' | grep -A 10 -E \"ibm_is_instance|primary_network_interface\"\n")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-output"},'...\n--\n  "type": "ibm_is_instance",\n  "name": "pluto_01_nfs",\n  "provider": "provider[\\"registry.terraform.io/ibm-cloud/ibm\\"]",\n  "instances": [\n...\n--\n        "primary_network_interface": [\n...\n            "name": "pluto-01-nfs-nic",\n            "port_speed": 0,\n            "primary_ipv4_address": "10.227.0.138",\n')),Object(o.b)("p",null,"In the above examples, the IP addresses are:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Bastion public IP address: ",Object(o.b)("inlineCode",{parentName:"li"},"149.81.215.172")),Object(o.b)("li",{parentName:"ul"},"NFS server private IP address: ",Object(o.b)("inlineCode",{parentName:"li"},"10.227.0.138"))),Object(o.b)("h2",null,"SSH to the NFS server"),Object(o.b)("p",null,"Finally, to get command line access to the NFS server:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'BASTION_IP=149.81.215.172\nNFS_IP=10.227.0.138\nssh -i $SSH_FILE \\\n  -o ProxyCommand="ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null \\\n  -i $SSH_FILE -W %h:%p -q $BASTION_IP" \\\n  root@$NFS_IP\n')),Object(o.b)("h2",null,"Stopping the session"),Object(o.b)("p",null,"Once you’ve finished exploring the NFS server, you can exit from it:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},"exit\n")),Object(o.b)("p",null,"Finally, exit from the deployer container which is then terminated."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},"exit\n")))}d.isMDXComponent=!0},I8xM:function(e,t,n){e.exports={bxTextTruncateEnd:"PageTabs-module--bx--text-truncate--end--267NA",bxTextTruncateFront:"PageTabs-module--bx--text-truncate--front--3xEQF",tabsContainer:"PageTabs-module--tabs-container--8N4k0",list:"PageTabs-module--list--3eFQc",listItem:"PageTabs-module--list-item--nUmtD",link:"PageTabs-module--link--1mDJ1",selectedItem:"PageTabs-module--selected-item--YPVr3"}},OIbQ:function(e,t,n){e.exports={bxTextTruncateEnd:"last-modified-date-module--bx--text-truncate--end--123zi",bxTextTruncateFront:"last-modified-date-module--bx--text-truncate--front--3xeKz",text:"last-modified-date-module--text--24m-4",row:"last-modified-date-module--row--2BquN"}},QH2O:function(e,t,n){e.exports={bxTextTruncateEnd:"PageHeader-module--bx--text-truncate--end--mZWeX",bxTextTruncateFront:"PageHeader-module--bx--text-truncate--front--3zvrI",pageHeader:"PageHeader-module--page-header--3hIan",darkMode:"PageHeader-module--dark-mode--hBrwL",withTabs:"PageHeader-module--with-tabs--3nKxA",text:"PageHeader-module--text--o9LFq"}}}]);
//# sourceMappingURL=component---src-pages-troubleshooting-ibm-cloud-access-nfs-server-mdx-d77e126dc3a737da1372.js.map