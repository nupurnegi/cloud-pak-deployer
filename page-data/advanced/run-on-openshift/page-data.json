{"componentChunkName":"component---src-pages-advanced-run-on-openshift-index-mdx","path":"/advanced/run-on-openshift/","result":{"pageContext":{"frontmatter":{"description":"Advanced / Run On Openshift","title":"Advanced / Run On Openshift"},"relativePagePath":"/advanced/run-on-openshift/index.mdx","titleType":"page","MdxNode":{"id":"1f1ae065-148e-58a3-ac01-312893a97df9","children":[],"parent":"98036287-1fb1-5b7d-b4f0-ee546a34ffbe","internal":{"content":"# Running deployer as a pod for existing OpenShift cluster\n\n## Collect cluster credentials\n* Cluster: ...\n* OpenShift admin user: `kubeadmin`\n* Password: ...\n\n## Login to cluster\n```\noc login ... --insecure-skip-tls-verify\n```\n\n## Create config\n```\nexport CONFIG_DIR=./cpd-config && mkdir -p $CONFIG_DIR\nexport STATUS_DIR=./cpd-status && mkdir -p $STATUS_DIR\n\nmkdir -p $CONFIG_DIR/{config,inventory}\n\ncat << EOF > $CONFIG_DIR/inventory/sample.inv\n[automation]\nlocalhost\n\n[automation:vars]\nenvironment_name=sample\n\n# Uncomment for Existing OpenShift deployment\ncloud_platform=existing-ocp\n\n#####################\n# Using File Vault\n#####################\nvault_type=file-vault\nvault_authentication_type=none\n\nEOF\n\ncat << EOF > $CONFIG_DIR/config/sample.yaml\n---\nopenshift:\n- name: cpd-demo\n  ocp_version: 4.8\n  cluster_name: cpd-demo\n  domain_name: example.com\n  openshift_storage:\n  - storage_name: nfs-storage\n    storage_type: nfs\n\ncp4d:\n\n- project: zen-40\n  openshift_cluster_name: cpd-demo\n  cp4d_version: 4.0.8\n  olm_utils: True\n  cartridges:\n  - name: cp-foundation\n    license_service:\n      state: disabled\n      threads_per_core: 2\n  - name: lite\n\n#\n# All tested cartridges. To install, change the \"state\" property to \"installed\". To uninstall, change the state\n# to \"removed\" or comment out the entire cartridge. Make sure that the \"-\" and properties are aligned with the lite\n# cartridge; the \"-\" is at position 3 and the property starts at position 5.\n#\n\n  - name: analyticsengine \n    size: small \n    state: removed\n\n  - name: bigsql\n    state: removed\n\n  - name: ca\n    size: small\n    instances:\n    - name: ca-instance\n      metastore_ref: ca-metastore\n    state: removed\n\n  - name: cde\n    state: removed\n\n  - name: datagate\n    state: removed\n\n  - name: datastage-ent-plus\n    state: installed\n\n  - name: db2\n    size: small\n    instances:\n    - name: ca-metastore\n      metadata_size_gb: 20\n      data_size_gb: 20\n      backup_size_gb: 20  \n      transactionlog_size_gb: 20\n    state: removed\n\n  - name: db2u\n    state: removed\n\n  - name: db2wh\n    state: removed\n\n  - name: dmc\n    state: removed\n\n  - name: dods\n    size: small\n    state: removed\n\n  - name: dp\n    size: small\n    state: removed\n\n  - name: dv\n    size: small \n    instances:\n    - name: data-virtualization\n    state: removed\n\n  - name: hadoop\n    size: small\n    state: removed\n\n  - name: mdm\n    size: small\n    wkc_enabled: true\n    state: removed\n\n  - name: openpages\n    state: removed\n\n  - name: planning-analytics\n    state: removed\n\n  - name: rstudio\n    size: small\n    state: removed\n\n  - name: spss\n    state: removed\n\n  - name: voice-gateway\n    replicas: 1\n    state: removed\n\n  - name: watson-assistant\n    size: small\n    state: removed\n\n  - name: watson-discovery\n    state: removed\n\n  - name: watson-ks\n    size: small\n    state: removed\n\n  - name: watson-openscale\n    size: small\n    state: removed\n\n  - name: watson-speech\n    stt_size: xsmall\n    tts_size: xsmall\n    state: removed\n\n  - name: wkc\n    size: small\n    state: removed\n\n  - name: wml\n    size: small\n    state: removed\n\n  - name: wml-accelerator\n    replicas: 1\n    size: small\n    state: removed\n\n  - name: wsl\n    state: installed\n\nEOF\n```\n\n## Start deployer\n```\noc new-project cloud-pak-deployer\n\noc project cloud-pak-deployer\noc create serviceaccount cloud-pak-deployer-sa\noc adm policy add-scc-to-user privileged -z cloud-pak-deployer-sa\noc adm policy add-cluster-role-to-user cluster-admin -z cloud-pak-deployer-sa\n\ncat << EOF | oc apply -f -\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: cloud-pak-deployer\n  name: cloud-pak-deployer\n  namespace: cloud-pak-deployer\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      deployment: cloud-pak-deployer\n  template:\n    metadata:\n      labels:\n        deployment: cloud-pak-deployer\n    spec:\n      containers:\n      - image: quay.io/fketelaars/cloud-pak-deployer:latest\n        imagePullPolicy: Always\n        name: cloud-pak-deployer\n        terminationMessagePath: /dev/termination-log\n        terminationMessagePolicy: File\n        volumeMounts:\n        - mountPath: /Data\n          name: cloud-pak-deployer-volume-1\n        command: [\"/bin/sh\",\"-xc\"]\n        args: \n          - sleep infinity\n      restartPolicy: Always\n      schedulerName: default-scheduler\n      securityContext:\n        runAsUser: 0\n      serviceAccountName: cloud-pak-deployer-sa\n      terminationGracePeriodSeconds: 30\n      volumes:\n      - emptyDir: {}\n        name: cloud-pak-deployer-volume-1\nEOF\n```\n\n## Copy config\n```\noc cp $CONFIG_DIR $(oc get po --no-headers -l deployment=cloud-pak-deployer | head -1 | awk '{print $1}'):/Data/cpd-config\noc cp $STATUS_DIR $(oc get po --no-headers -l deployment=cloud-pak-deployer | head -1 | awk '{print $1}'):/Data/cpd-status\n```\n\n## Prepare for deployer run\n```\noc rsh deploy/cloud-pak-deployer /cloud-pak-deployer/cp-deploy.sh vault set \\\n  -vs cp_entitlement_key -vsv \"your_entitlement_key\" \\\n  --config-dir=/Data/cpd-config --status-dir=/Data/cpd-status\noc rsh deploy/cloud-pak-deployer /cloud-pak-deployer/cp-deploy.sh vault set \\\n  -vs cpd-demo-oc-login -vsv \"your_oc_login_command\" \\\n  --config-dir=/Data/cpd-config --status-dir=/Data/cpd-status\noc rsh deploy/cloud-pak-deployer /cloud-pak-deployer/cp-deploy.sh vault list \\\n  --config-dir=/Data/cpd-config --status-dir=/Data/cpd-status\n```\n\n## Run deployer\n```\noc rsh deploy/cloud-pak-deployer /cloud-pak-deployer/cp-deploy.sh env apply -v \\\n    --config-dir=/Data/cpd-config --status-dir=/Data/cpd-status\n```","type":"Mdx","contentDigest":"ed32ffcdda8755e90521e4546112d959","owner":"gatsby-plugin-mdx","counter":200},"frontmatter":{"description":"Advanced / Run On Openshift","title":"Advanced / Run On Openshift"},"exports":{},"rawBody":"# Running deployer as a pod for existing OpenShift cluster\n\n## Collect cluster credentials\n* Cluster: ...\n* OpenShift admin user: `kubeadmin`\n* Password: ...\n\n## Login to cluster\n```\noc login ... --insecure-skip-tls-verify\n```\n\n## Create config\n```\nexport CONFIG_DIR=./cpd-config && mkdir -p $CONFIG_DIR\nexport STATUS_DIR=./cpd-status && mkdir -p $STATUS_DIR\n\nmkdir -p $CONFIG_DIR/{config,inventory}\n\ncat << EOF > $CONFIG_DIR/inventory/sample.inv\n[automation]\nlocalhost\n\n[automation:vars]\nenvironment_name=sample\n\n# Uncomment for Existing OpenShift deployment\ncloud_platform=existing-ocp\n\n#####################\n# Using File Vault\n#####################\nvault_type=file-vault\nvault_authentication_type=none\n\nEOF\n\ncat << EOF > $CONFIG_DIR/config/sample.yaml\n---\nopenshift:\n- name: cpd-demo\n  ocp_version: 4.8\n  cluster_name: cpd-demo\n  domain_name: example.com\n  openshift_storage:\n  - storage_name: nfs-storage\n    storage_type: nfs\n\ncp4d:\n\n- project: zen-40\n  openshift_cluster_name: cpd-demo\n  cp4d_version: 4.0.8\n  olm_utils: True\n  cartridges:\n  - name: cp-foundation\n    license_service:\n      state: disabled\n      threads_per_core: 2\n  - name: lite\n\n#\n# All tested cartridges. To install, change the \"state\" property to \"installed\". To uninstall, change the state\n# to \"removed\" or comment out the entire cartridge. Make sure that the \"-\" and properties are aligned with the lite\n# cartridge; the \"-\" is at position 3 and the property starts at position 5.\n#\n\n  - name: analyticsengine \n    size: small \n    state: removed\n\n  - name: bigsql\n    state: removed\n\n  - name: ca\n    size: small\n    instances:\n    - name: ca-instance\n      metastore_ref: ca-metastore\n    state: removed\n\n  - name: cde\n    state: removed\n\n  - name: datagate\n    state: removed\n\n  - name: datastage-ent-plus\n    state: installed\n\n  - name: db2\n    size: small\n    instances:\n    - name: ca-metastore\n      metadata_size_gb: 20\n      data_size_gb: 20\n      backup_size_gb: 20  \n      transactionlog_size_gb: 20\n    state: removed\n\n  - name: db2u\n    state: removed\n\n  - name: db2wh\n    state: removed\n\n  - name: dmc\n    state: removed\n\n  - name: dods\n    size: small\n    state: removed\n\n  - name: dp\n    size: small\n    state: removed\n\n  - name: dv\n    size: small \n    instances:\n    - name: data-virtualization\n    state: removed\n\n  - name: hadoop\n    size: small\n    state: removed\n\n  - name: mdm\n    size: small\n    wkc_enabled: true\n    state: removed\n\n  - name: openpages\n    state: removed\n\n  - name: planning-analytics\n    state: removed\n\n  - name: rstudio\n    size: small\n    state: removed\n\n  - name: spss\n    state: removed\n\n  - name: voice-gateway\n    replicas: 1\n    state: removed\n\n  - name: watson-assistant\n    size: small\n    state: removed\n\n  - name: watson-discovery\n    state: removed\n\n  - name: watson-ks\n    size: small\n    state: removed\n\n  - name: watson-openscale\n    size: small\n    state: removed\n\n  - name: watson-speech\n    stt_size: xsmall\n    tts_size: xsmall\n    state: removed\n\n  - name: wkc\n    size: small\n    state: removed\n\n  - name: wml\n    size: small\n    state: removed\n\n  - name: wml-accelerator\n    replicas: 1\n    size: small\n    state: removed\n\n  - name: wsl\n    state: installed\n\nEOF\n```\n\n## Start deployer\n```\noc new-project cloud-pak-deployer\n\noc project cloud-pak-deployer\noc create serviceaccount cloud-pak-deployer-sa\noc adm policy add-scc-to-user privileged -z cloud-pak-deployer-sa\noc adm policy add-cluster-role-to-user cluster-admin -z cloud-pak-deployer-sa\n\ncat << EOF | oc apply -f -\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: cloud-pak-deployer\n  name: cloud-pak-deployer\n  namespace: cloud-pak-deployer\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      deployment: cloud-pak-deployer\n  template:\n    metadata:\n      labels:\n        deployment: cloud-pak-deployer\n    spec:\n      containers:\n      - image: quay.io/fketelaars/cloud-pak-deployer:latest\n        imagePullPolicy: Always\n        name: cloud-pak-deployer\n        terminationMessagePath: /dev/termination-log\n        terminationMessagePolicy: File\n        volumeMounts:\n        - mountPath: /Data\n          name: cloud-pak-deployer-volume-1\n        command: [\"/bin/sh\",\"-xc\"]\n        args: \n          - sleep infinity\n      restartPolicy: Always\n      schedulerName: default-scheduler\n      securityContext:\n        runAsUser: 0\n      serviceAccountName: cloud-pak-deployer-sa\n      terminationGracePeriodSeconds: 30\n      volumes:\n      - emptyDir: {}\n        name: cloud-pak-deployer-volume-1\nEOF\n```\n\n## Copy config\n```\noc cp $CONFIG_DIR $(oc get po --no-headers -l deployment=cloud-pak-deployer | head -1 | awk '{print $1}'):/Data/cpd-config\noc cp $STATUS_DIR $(oc get po --no-headers -l deployment=cloud-pak-deployer | head -1 | awk '{print $1}'):/Data/cpd-status\n```\n\n## Prepare for deployer run\n```\noc rsh deploy/cloud-pak-deployer /cloud-pak-deployer/cp-deploy.sh vault set \\\n  -vs cp_entitlement_key -vsv \"your_entitlement_key\" \\\n  --config-dir=/Data/cpd-config --status-dir=/Data/cpd-status\noc rsh deploy/cloud-pak-deployer /cloud-pak-deployer/cp-deploy.sh vault set \\\n  -vs cpd-demo-oc-login -vsv \"your_oc_login_command\" \\\n  --config-dir=/Data/cpd-config --status-dir=/Data/cpd-status\noc rsh deploy/cloud-pak-deployer /cloud-pak-deployer/cp-deploy.sh vault list \\\n  --config-dir=/Data/cpd-config --status-dir=/Data/cpd-status\n```\n\n## Run deployer\n```\noc rsh deploy/cloud-pak-deployer /cloud-pak-deployer/cp-deploy.sh env apply -v \\\n    --config-dir=/Data/cpd-config --status-dir=/Data/cpd-status\n```","fileAbsolutePath":"/home/runner/work/cloud-pak-deployer/cloud-pak-deployer/doc/src/pages/advanced/run-on-openshift/index.mdx"}}},"staticQueryHashes":["1364590287","137577622","137577622","2102389209","2102389209","2456312558","2746626797","2746626797","3018647132","3018647132","3037994772","3037994772","768070550"]}