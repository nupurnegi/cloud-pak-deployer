{"componentChunkName":"component---src-pages-cpd-design-objects-cp-4-d-monitors-mdx","path":"/cpd-design/objects/cp4d_monitors/","result":{"pageContext":{"frontmatter":{"title":"Cloud Pak for Data Monitor configuration"},"relativePagePath":"/cpd-design/objects/cp4d_monitors.mdx","titleType":"page","MdxNode":{"id":"843f820a-8192-5ba1-a791-ab0b5eda935c","children":[],"parent":"ea56c42c-b03c-5f94-9ecb-2962677f45b5","internal":{"content":"---\ntitle: Cloud Pak for Data Monitor configuration\n---\n\nUsing the Cloud Pak Deployer,monitors can be deployed which uses the Cloud Pak for Data zen-watchdog monitor framework. \nThis allows adding custom monitors to the zen-watchdog, making these custom monitors visible in the Cloud Pak for Data metrics.\n\n![Cloud Pak for Data Monitors Overview](cp4d_monitors.png \"Cloud Pak for Data Monitors Overview\")\n\nUsing the Cloud Pak Deployer cp4d_monitors capability implements the following:\n- Create Cloud Pak for Data ServiceMonitor endpoint to forward zen-watchdog monitor events to OpenShift Cluster monitoring\n- Create source repository auth secrets (optional, if pulling monitors from secure repo)\n- Create target container registry auth secrets (optional, if pushing monitor images to secure container registry)\n- Deploy custom monitors, which will be added to the zen-watchdog monitor framework\n\nFor custom monitors to be deployed, it is mandatory to enable the OpenShift user-workload monitoring, which can be specified using the `openshift_monitoring` configuration element. More information is available [here](/cpd-design/components/monitoring).\n\n\nEach `cp4d_monitors` entry contains a set of default settings, which are applicable to the `monitors` list. These defaults can be overwritten per monitor if needed.\n\n| Property | Description                                                          | Mandatory | Allowed values |\n| -------- | -------------------------------------------------------------------- | --------- | -------------- |\n| name  | The name of the monitor set    | Yes       | lowercase RFC 1123 subdomain (1)  |\n| cp4d_instance | The OpenShift project (namespace) on which the Cloud Pak for Data instance resides  | Yes       |  |\n| openshift_cluster_name | The Openshift cluster name | Yes |  |\n| default_monitor_source_repo | The default repository location of all monitors located in the `monitors` section | No |  |\n| default_monitor_source_token_secret | The default repo access token secret name, must be available in the vault | No |  |\n| default_monitor_target_cr |   The default target container registry (cr) for the monitor image to be pushed. When omitted, the OpenShift internal registry is used | No |  |\n| default_monitor_target_cr_user_secret | The default target container registry user name secret name used to push the monitor image. Must be available in the vault | No |  |\n| default_monitor_target_cr_password_secret | The default target container registry password secret name used to push the monitor image. Must be available in the vault | No |  |\n| monitors | List of monitors | Yes |  |\n\nPer `monitors` entry, the following settings are specified:\n\n| Property | Description                                                          | Mandatory | Allowed values |\n| -------- | -------------------------------------------------------------------- | --------- | -------------- |\n| name  | The name of the monitor entry     | Yes       | lowercase RFC 1123 subdomain (1)   |\n| monitor_source_repo | Overrides default_monitor_source_repo for this single monitor | No | | \n| monitor_source_token_secret | Overrides default_monitor_source_token_secret for this single monitor | No | | \n| monitor_target_cr | Overrides default_monitor_target_cr for this single monitor | No | | \n| monitor_target_cr_user_secret | Overrides default_monitor_target_cr_user_secret for this single monitor | No | | \n| monitor_target_cr_user_password | Overrides default_monitor_target_cr_user_password for this single monitor | No | | \n| context | Sets the context of the monitor the the source repo (sub folder name) | Yes | | \n| label | Set the label of the pushed image, default to 'latest' | No | | \n| schedule | Sets the schedule of the generated Cloud Pak for Data monitor cronjob | Yes | | \n\nEach monitor has a set of `event_types`, which contain the observations generated by the monitor. These event types are retrieved directly from the github repository, which it is expected that each `context` contains a file called `event_types.yml`. During deployment of the monitor this file is retrieved and used to populate the `event_types` of the monitor. \n\nIf the Deployer runs and the monitor is already deployed, the following process is used:\n- The build process is restarted to ensure the latest image of monitor is used\n- A comparison is made between the monitor's current configuration and the configuration created by the Deployer. If these are identical, the monitor's configuration is left as-is, however if these are different, the monitor's configuration is rebuild and the monitor is re-deployed. \n\nFile: config/cp4d_monitors.yaml\n\n```\n---\n#Enable OpenShift user-workload monitoring\nopenshift_monitoring:\n- openshift_cluster_name: pluto-01\n  user_workload: enabled\n  remote_rewrite_url: http://www.example.com:1234/receive\n  retention_period: 15d\n  pvc_storage_class: ibmc-vpc-block-retain-general-purpose\n  pvc_storage_size_gb: 100\n  grafana_operator: enabled\n  grafana_project: grafana\n\n# List of cp4d_monitors\ncp4d_monitors:\n- name: cp4d-monitor-set-1\n  cp4d_instance: zen-45\n  openshift_cluster_name: pluto-01\n  default_monitor_source_repo: https://github.com/IBM/cp4d-monitors\n  #default_monitor_source_token_secret: monitors_source_repo_secret\n  #default_monitor_target_cr: de.icr.io/monitorrepo  \n  #default_monitor_target_cr_user_secret: monitors_target_cr_username\n  #default_monitor_target_cr_password_secret: monitors_target_cr_password\n  # List of monitors\n  monitors:\n  - name: cp4d-cognos-task-info\n    context: cp4d-cognos-task-info\n    label: latest\n    schedule: \"*/15 * * * *\"\n  - name: cp4d-platform-global-connections\n    context: cp4d-platform-global-connections\n    label: latest\n    schedule: \"*/15 * * * *\"\n  - name: cp4d-watsonstudio-job-info-monitor\n    context: cp4d-watsonstudio-job-info\n    label: latest\n    schedule: \"*/15 * * * *\"\n  - name: cp4d-platform-watsonstudio-schedule-job-info\n    context: cp4d-watsonstudio-job-schedule-info\n    label: latest\n    schedule: \"*/15 * * * *\"\n  - name: cp4d-platform-watsonstudio-runtime-usage\n    context: cp4d-watsonstudio-runtime-usage\n    label: latest\n    schedule: \"*/15 * * * *\"\n  - name: cp4d-wkc-info\n    context: cp4d-wkc-info\n    label: latest\n    schedule: \"*/15 * * * *\"\n  - name: cp4d-platform-wml-deployment-space-info\n    context: cp4d-wml-deployment-space-info\n    label: latest  \n    schedule: \"*/15 * * * *\"\n  - name: cp4d-platform-wml-deployment-space-job-info\n    context: cp4d-wml-deployment-space-job-info\n    label: latest\n    schedule: \"*/15 * * * *\"\n```","type":"Mdx","contentDigest":"7bd50d958a4946f09a8c84f5e533491b","owner":"gatsby-plugin-mdx","counter":232},"frontmatter":{"title":"Cloud Pak for Data Monitor configuration"},"exports":{},"rawBody":"---\ntitle: Cloud Pak for Data Monitor configuration\n---\n\nUsing the Cloud Pak Deployer,monitors can be deployed which uses the Cloud Pak for Data zen-watchdog monitor framework. \nThis allows adding custom monitors to the zen-watchdog, making these custom monitors visible in the Cloud Pak for Data metrics.\n\n![Cloud Pak for Data Monitors Overview](cp4d_monitors.png \"Cloud Pak for Data Monitors Overview\")\n\nUsing the Cloud Pak Deployer cp4d_monitors capability implements the following:\n- Create Cloud Pak for Data ServiceMonitor endpoint to forward zen-watchdog monitor events to OpenShift Cluster monitoring\n- Create source repository auth secrets (optional, if pulling monitors from secure repo)\n- Create target container registry auth secrets (optional, if pushing monitor images to secure container registry)\n- Deploy custom monitors, which will be added to the zen-watchdog monitor framework\n\nFor custom monitors to be deployed, it is mandatory to enable the OpenShift user-workload monitoring, which can be specified using the `openshift_monitoring` configuration element. More information is available [here](/cpd-design/components/monitoring).\n\n\nEach `cp4d_monitors` entry contains a set of default settings, which are applicable to the `monitors` list. These defaults can be overwritten per monitor if needed.\n\n| Property | Description                                                          | Mandatory | Allowed values |\n| -------- | -------------------------------------------------------------------- | --------- | -------------- |\n| name  | The name of the monitor set    | Yes       | lowercase RFC 1123 subdomain (1)  |\n| cp4d_instance | The OpenShift project (namespace) on which the Cloud Pak for Data instance resides  | Yes       |  |\n| openshift_cluster_name | The Openshift cluster name | Yes |  |\n| default_monitor_source_repo | The default repository location of all monitors located in the `monitors` section | No |  |\n| default_monitor_source_token_secret | The default repo access token secret name, must be available in the vault | No |  |\n| default_monitor_target_cr |   The default target container registry (cr) for the monitor image to be pushed. When omitted, the OpenShift internal registry is used | No |  |\n| default_monitor_target_cr_user_secret | The default target container registry user name secret name used to push the monitor image. Must be available in the vault | No |  |\n| default_monitor_target_cr_password_secret | The default target container registry password secret name used to push the monitor image. Must be available in the vault | No |  |\n| monitors | List of monitors | Yes |  |\n\nPer `monitors` entry, the following settings are specified:\n\n| Property | Description                                                          | Mandatory | Allowed values |\n| -------- | -------------------------------------------------------------------- | --------- | -------------- |\n| name  | The name of the monitor entry     | Yes       | lowercase RFC 1123 subdomain (1)   |\n| monitor_source_repo | Overrides default_monitor_source_repo for this single monitor | No | | \n| monitor_source_token_secret | Overrides default_monitor_source_token_secret for this single monitor | No | | \n| monitor_target_cr | Overrides default_monitor_target_cr for this single monitor | No | | \n| monitor_target_cr_user_secret | Overrides default_monitor_target_cr_user_secret for this single monitor | No | | \n| monitor_target_cr_user_password | Overrides default_monitor_target_cr_user_password for this single monitor | No | | \n| context | Sets the context of the monitor the the source repo (sub folder name) | Yes | | \n| label | Set the label of the pushed image, default to 'latest' | No | | \n| schedule | Sets the schedule of the generated Cloud Pak for Data monitor cronjob | Yes | | \n\nEach monitor has a set of `event_types`, which contain the observations generated by the monitor. These event types are retrieved directly from the github repository, which it is expected that each `context` contains a file called `event_types.yml`. During deployment of the monitor this file is retrieved and used to populate the `event_types` of the monitor. \n\nIf the Deployer runs and the monitor is already deployed, the following process is used:\n- The build process is restarted to ensure the latest image of monitor is used\n- A comparison is made between the monitor's current configuration and the configuration created by the Deployer. If these are identical, the monitor's configuration is left as-is, however if these are different, the monitor's configuration is rebuild and the monitor is re-deployed. \n\nFile: config/cp4d_monitors.yaml\n\n```\n---\n#Enable OpenShift user-workload monitoring\nopenshift_monitoring:\n- openshift_cluster_name: pluto-01\n  user_workload: enabled\n  remote_rewrite_url: http://www.example.com:1234/receive\n  retention_period: 15d\n  pvc_storage_class: ibmc-vpc-block-retain-general-purpose\n  pvc_storage_size_gb: 100\n  grafana_operator: enabled\n  grafana_project: grafana\n\n# List of cp4d_monitors\ncp4d_monitors:\n- name: cp4d-monitor-set-1\n  cp4d_instance: zen-45\n  openshift_cluster_name: pluto-01\n  default_monitor_source_repo: https://github.com/IBM/cp4d-monitors\n  #default_monitor_source_token_secret: monitors_source_repo_secret\n  #default_monitor_target_cr: de.icr.io/monitorrepo  \n  #default_monitor_target_cr_user_secret: monitors_target_cr_username\n  #default_monitor_target_cr_password_secret: monitors_target_cr_password\n  # List of monitors\n  monitors:\n  - name: cp4d-cognos-task-info\n    context: cp4d-cognos-task-info\n    label: latest\n    schedule: \"*/15 * * * *\"\n  - name: cp4d-platform-global-connections\n    context: cp4d-platform-global-connections\n    label: latest\n    schedule: \"*/15 * * * *\"\n  - name: cp4d-watsonstudio-job-info-monitor\n    context: cp4d-watsonstudio-job-info\n    label: latest\n    schedule: \"*/15 * * * *\"\n  - name: cp4d-platform-watsonstudio-schedule-job-info\n    context: cp4d-watsonstudio-job-schedule-info\n    label: latest\n    schedule: \"*/15 * * * *\"\n  - name: cp4d-platform-watsonstudio-runtime-usage\n    context: cp4d-watsonstudio-runtime-usage\n    label: latest\n    schedule: \"*/15 * * * *\"\n  - name: cp4d-wkc-info\n    context: cp4d-wkc-info\n    label: latest\n    schedule: \"*/15 * * * *\"\n  - name: cp4d-platform-wml-deployment-space-info\n    context: cp4d-wml-deployment-space-info\n    label: latest  \n    schedule: \"*/15 * * * *\"\n  - name: cp4d-platform-wml-deployment-space-job-info\n    context: cp4d-wml-deployment-space-job-info\n    label: latest\n    schedule: \"*/15 * * * *\"\n```","fileAbsolutePath":"/home/runner/work/cloud-pak-deployer/cloud-pak-deployer/doc/src/pages/cpd-design/objects/cp4d_monitors.mdx"}}},"staticQueryHashes":["1364590287","137577622","137577622","2102389209","2102389209","2456312558","2746626797","2746626797","3018647132","3018647132","3037994772","3037994772","768070550"]}